<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard ROI - Location Autos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background-color: #111827; color: #e5e7eb; }
    .card { background-color: #1f2937; border-radius: 0.75rem; padding: 1.5rem; }
    .btn { background-color: #2563eb; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; }
    .btn:hover { background-color: #1e40af; }
    input, select {
      background-color: #374151; color: #f3f4f6; border-radius: 0.375rem; padding: 0.5rem;
    }
  </style>
</head>
<body class="p-6">
  <h1 class="text-3xl font-bold mb-6 text-center">📊 Dashboard ROI - Flotte Auto</h1>

  <!-- Onglets -->
  <div class="flex justify-center space-x-4 mb-6">
    <button class="btn" onclick="showTab('locations')">Locations réelles</button>
    <button class="btn" onclick="showTab('params')">Paramètres</button>
    <button class="btn" onclick="showTab('previsions')">Prévisions & Tarifs</button>
    <button class="btn" onclick="showTab('suivi')">Suivi mensuel</button>
  </div>

  <!-- Locations -->
  <div id="locations" class="tab card hidden">
    <h2 class="text-xl font-semibold mb-4">📅 Locations réelles</h2>
    <form id="locationForm" class="space-y-2">
      <input type="date" id="date" required />
      <input type="number" id="revenu" placeholder="Revenu brut (€)" required />
      <input type="number" id="commission" placeholder="Commission (€)" required />
      <input type="number" id="carburant" placeholder="Carburant (€)" />
      <button type="submit" class="btn">Ajouter</button>
    </form>
    <ul id="locationList" class="mt-4 space-y-2"></ul>
  </div>

  <!-- Paramètres -->
  <div id="params" class="tab card hidden">
    <h2 class="text-xl font-semibold mb-4">⚙️ Paramètres</h2>
    <label>Frais assurance mensuels (€):</label>
    <input type="number" id="assurance" value="54" class="w-full mb-2"/>
    <label>Frais boîtier Connect (€):</label>
    <input type="number" id="connect" value="25" class="w-full mb-2"/>
    <button class="btn mt-2" onclick="saveParams()">💾 Sauvegarder</button>
  </div>

  <!-- Prévisions -->
  <div id="previsions" class="tab card hidden">
    <h2 class="text-xl font-semibold mb-4">📈 Prévisions & Tarifs</h2>
    <label>Prix propriétaire (€):</label>
    <input type="number" id="prixProprio" value="24" class="w-full mb-2"/>
    <label>Jours estimés par mois:</label>
    <input type="number" id="joursEstim" value="10" class="w-full mb-2"/>
    <button class="btn mt-2" onclick="calcPrevision()">Calculer</button>
    <p id="previsionRes" class="mt-4"></p>
  </div>

  <!-- Suivi -->
  <div id="suivi" class="tab card hidden">
    <h2 class="text-xl font-semibold mb-4">📊 Suivi mensuel</h2>
    <canvas id="chartSuivi" class="w-full h-64"></canvas>
  </div>

  <script>
    let locations = JSON.parse(localStorage.getItem("locations")) || [];
    let params = JSON.parse(localStorage.getItem("params")) || { assurance:54, connect:25 };

    function showTab(id) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      if(id==="suivi") renderChart();
    }

    document.getElementById("locationForm").addEventListener("submit", e=>{
      e.preventDefault();
      const loc = {
        date: document.getElementById("date").value,
        revenu: +document.getElementById("revenu").value,
        commission: +document.getElementById("commission").value,
        carburant: +document.getElementById("carburant").value || 0
      };
      locations.push(loc);
      localStorage.setItem("locations", JSON.stringify(locations));
      renderLocations();
    });

    function renderLocations(){
      const list = document.getElementById("locationList");
      list.innerHTML="";
      locations.forEach((l,i)=>{
        const li=document.createElement("li");
        li.textContent=`${l.date} - Net: ${l.revenu - l.commission - l.carburant}€`;
        list.appendChild(li);
      });
    }
    renderLocations();

    function saveParams(){
      params.assurance = +document.getElementById("assurance").value;
      params.connect = +document.getElementById("connect").value;
      localStorage.setItem("params", JSON.stringify(params));
      alert("✅ Paramètres sauvegardés !");
    }

    function calcPrevision(){
      let prix = +document.getElementById("prixProprio").value;
      let jours = +document.getElementById("joursEstim").value;
      let brut = prix*jours;
      let fixe = params.assurance+params.connect;
      let net = brut-fixe;
      document.getElementById("previsionRes").textContent=
        `Prévision brute: ${brut}€, Frais fixes: ${fixe}€, Net: ${net}€`;
    }

    function renderChart(){
      const ctx=document.getElementById("chartSuivi").getContext("2d");
      const monthly = {};
      locations.forEach(l=>{
        let m=l.date.slice(0,7);
        monthly[m]=(monthly[m]||0)+(l.revenu-l.commission-l.carburant);
      });
      new Chart(ctx,{type:"bar",
        data:{labels:Object.keys(monthly),
          datasets:[{label:"Revenus nets",data:Object.values(monthly),backgroundColor:"#3b82f6"}]
        }
      });
    }
  </script>
</body>
</html>
