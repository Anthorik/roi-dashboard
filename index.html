<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mon Dashboard ROI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-6xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-6">ğŸ“Š Dashboard RentabilitÃ©</h1>

    <!-- Onglets -->
    <div class="flex space-x-4 mb-6">
      <button onclick="showTab('locations')" class="tab-btn bg-blue-500 text-white px-4 py-2 rounded">ğŸš— Locations</button>
      <button onclick="showTab('parametres')" class="tab-btn bg-gray-300 px-4 py-2 rounded">âš™ï¸ ParamÃ¨tres</button>
      <button onclick="showTab('previsions')" class="tab-btn bg-gray-300 px-4 py-2 rounded">ğŸ“ˆ PrÃ©visions</button>
      <button onclick="showTab('suivi')" class="tab-btn bg-gray-300 px-4 py-2 rounded">ğŸ“… Suivi Mensuel</button>
    </div>

    <!-- Onglet Locations -->
    <div id="locations" class="tab">
      <h2 class="text-xl font-semibold mb-4">Ajouter une location rÃ©elle</h2>
      <form id="locationForm" class="space-y-4 mb-6">
        <input type="date" id="date" class="border p-2 rounded w-full" required />
        <input type="number" id="revenu" placeholder="Revenu brut (â‚¬)" class="border p-2 rounded w-full" required />
        <input type="number" id="commission" placeholder="Commission (â‚¬)" class="border p-2 rounded w-full" required />
        <input type="number" id="carburant" placeholder="Frais carburant (â‚¬)" class="border p-2 rounded w-full" />
        <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">Ajouter</button>
      </form>

      <table class="w-full border-collapse bg-white shadow rounded">
        <thead class="bg-blue-100">
          <tr>
            <th class="p-2 border">Date</th>
            <th class="p-2 border">Revenu (â‚¬)</th>
            <th class="p-2 border">Commission (â‚¬)</th>
            <th class="p-2 border">Carburant (â‚¬)</th>
            <th class="p-2 border">Net (â‚¬)</th>
            <th class="p-2 border">Actions</th>
          </tr>
        </thead>
        <tbody id="locationTable"></tbody>
      </table>
    </div>

    <!-- Onglet ParamÃ¨tres -->
    <div id="parametres" class="tab hidden">
      <h2 class="text-xl font-semibold mb-4">ParamÃ¨tres fixes</h2>
      <label class="block mb-2">Assurance mensuelle (â‚¬)</label>
      <input type="number" id="assurance" value="54" class="border p-2 rounded mb-4 w-full" />
      <label class="block mb-2">BoÃ®tier Connect (â‚¬)</label>
      <input type="number" id="connect" value="25" class="border p-2 rounded mb-4 w-full" />
      <button onclick="saveSettings()" class="bg-blue-500 text-white px-4 py-2 rounded">ğŸ’¾ Sauvegarder</button>
    </div>

    <!-- Onglet PrÃ©visions -->
    <div id="previsions" class="tab hidden">
      <h2 class="text-xl font-semibold mb-4">PrÃ©visions & Point Mort</h2>
      <canvas id="forecastChart" class="w-full h-64"></canvas>
    </div>

    <!-- Onglet Suivi -->
    <div id="suivi" class="tab hidden">
      <h2 class="text-xl font-semibold mb-4">Suivi Mensuel</h2>
      <canvas id="monthlyChart" class="w-full h-64"></canvas>
      <p id="summary" class="mt-4 font-bold"></p>
    </div>
  </div>

  <script>
    // Gestion onglets
    function showTab(id) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('bg-blue-500','text-white'));
      event.target.classList.add('bg-blue-500','text-white');
    }

    // Sauvegarde localStorage
    let locations = JSON.parse(localStorage.getItem("locations")) || [];
    let settings = JSON.parse(localStorage.getItem("settings")) || { assurance:54, connect:25 };

    function renderTable(){
      let tbody = document.getElementById("locationTable");
      tbody.innerHTML = "";
      locations.forEach((loc,i)=>{
        let net = loc.revenu - loc.commission - loc.carburant;
        tbody.innerHTML += `
          <tr>
            <td class="border p-2">${loc.date}</td>
            <td class="border p-2">${loc.revenu}</td>
            <td class="border p-2">${loc.commission}</td>
            <td class="border p-2">${loc.carburant}</td>
            <td class="border p-2 font-bold">${net}</td>
            <td class="border p-2"><button onclick="deleteLoc(${i})" class="text-red-500">ğŸ—‘ï¸</button></td>
          </tr>`;
      });
      updateCharts();
    }

    function deleteLoc(i){ locations.splice(i,1); saveData(); renderTable(); }
    function saveData(){ localStorage.setItem("locations", JSON.stringify(locations)); }
    function saveSettings(){
      settings.assurance = parseFloat(document.getElementById("assurance").value);
      settings.connect = parseFloat(document.getElementById("connect").value);
      localStorage.setItem("settings", JSON.stringify(settings));
      updateCharts();
      alert("ParamÃ¨tres sauvegardÃ©s âœ…");
    }

    document.getElementById("locationForm").addEventListener("submit", e=>{
      e.preventDefault();
      let loc = {
        date: document.getElementById("date").value,
        revenu: parseFloat(document.getElementById("revenu").value),
        commission: parseFloat(document.getElementById("commission").value),
        carburant: parseFloat(document.getElementById("carburant").value||0)
      };
      locations.push(loc); saveData(); renderTable(); e.target.reset();
    });

    // Charts
    let forecastChart, monthlyChart;
    function updateCharts(){
      let monthly = {};
      locations.forEach(l=>{
        let month = l.date.slice(0,7);
        let net = l.revenu - l.commission - l.carburant;
        monthly[month] = (monthly[month]||0) + net;
      });
      let months = Object.keys(monthly);
      let nets = Object.values(monthly);
      let costs = months.map(()=> -(settings.assurance+settings.connect));

      if(monthlyChart){ monthlyChart.destroy(); }
      monthlyChart = new Chart(document.getElementById("monthlyChart"),{
        type:"bar",
        data:{labels:months, datasets:[
          {label:"Net",data:nets, backgroundColor:"green"},
          {label:"Frais Fixes",data:costs, backgroundColor:"red"}
        ]}
      });

      let total = nets.reduce((a,b)=>a+b,0);
      let totalCost = costs.reduce((a,b)=>a+b,0);
      document.getElementById("summary").innerText = 
        `Bilan: ${total} â‚¬ vs Frais ${-totalCost} â‚¬ => ${(total+totalCost)>=0?"âœ… Positif":"âŒ NÃ©gatif"}`;
    }

    renderTable();
    document.getElementById("assurance").value=settings.assurance;
    document.getElementById("connect").value=settings.connect;
    updateCharts();
  </script>
</body>
</html>
